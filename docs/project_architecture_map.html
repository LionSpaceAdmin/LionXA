<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
  <title>LionXA - מפת ארכיטקטורה</title>
  <meta charset="UTF-8">
  <style>
    body, html { margin: 0; padding: 0; height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f7f9fc; }
    #cy { width: 100%; height: 100%; display: block; }
    .info { position: absolute; top: 15px; left: 15px; background: rgba(255, 255, 255, 0.95); padding: 12px; border: 1px solid #e1e4e8; border-radius: 8px; max-width: 320px; font-size: 13px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    .info strong { font-size: 16px; color: #24292e; }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
  <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>
</head>
<body>
  <div id="cy"></div>
  <div class="info">
    <strong>מפת ארכיטקטורת LionXA</strong><br>
    תצוגה אוטומטית של רכיבי הפרויקט והקשרים ביניהם.
  </div>
  <script>
    const architectureData = {
      "nodes": [
        // Services
        { "data": { "id": "service_frontend", "label": "שירות Frontend", "type": "service" } },
        { "data": { "id": "service_agent", "label": "שירות Agent", "type": "service" } },
        { "data": { "id": "service_mcp_gateway", "label": "שירות MCP Gateway", "type": "service" } },

        // Configs
        { "data": { "id": "docker_compose", "label": "docker-compose.yml", "type": "config" } },
        { "data": { "id": "package_json", "label": "package.json", "type": "manifest" } },
        { "data": { "id": "tsconfig", "label": "tsconfig.json", "type": "config" } },
        { "data": { "id": "next_config", "label": "next.config.mjs", "type": "config" } },

        // Dockerfiles
        { "data": { "id": "dockerfile_frontend", "label": "Dockerfile (Frontend)", "type": "dockerfile" } },
        { "data": { "id": "dockerfile_agent", "label": "Dockerfile (Agent)", "type": "dockerfile" } },
        { "data": { "id": "dockerfile_mcp", "label": "Dockerfile (MCP)", "type": "dockerfile" } },
        { "data": { "id": "base_image_node20", "label": "node:20-slim", "type": "base-image" } },

        // Source Code - Backend & Core
        { "data": { "id": "src_server", "label": "שרת ראשי\n(server.ts)", "type": "entrypoint" } },
        { "data": { "id": "src_dashboard", "label": "ניהול דשבורד\n(dashboard.ts)", "type": "module" } },
        
        // Source Code - Agent
        { "data": { "id": "src_agent", "label": "ליבת הסוכן\n(agent.ts)", "type": "entrypoint" } },
        { "data": { "id": "src_browser", "label": "שירות דפדפן\n(browserService.ts)", "type": "module" } },
        { "data": { "id": "src_gemini", "label": "אינטגרציית Gemini\n(gemini.ts)", "type": "module" } },
        { "data": { "id": "src_config", "label": "תצורת מערכת\n(config.ts)", "type": "config" } },

        // Source Code - Frontend
        { "data": { "id": "src_app_layout", "label": "פריסה ראשית\n(layout.tsx)", "type": "component" } },
        { "data": { "id": "src_app_page", "label": "דף הבית\n(page.tsx)", "type": "component" } },
        { "data": { "id": "src_header_component", "label": "Header Component", "type": "component" } },
        
        // Libraries
        { "data": { "id": "lib_next", "label": "Next.js", "type": "library" } },
        { "data": { "id": "lib_react", "label": "React", "type": "library" } },
        { "data": { "id": "lib_playwright", "label": "Playwright", "type": "library" } },
        { "data": { "id": "lib_socketio", "label": "Socket.IO", "type": "library" } }
      ],
      "edges": [
        // Docker Compose to Services
        { "data": { "source": "docker_compose", "target": "service_frontend", "label": "מגדיר" } },
        { "data": { "source": "docker_compose", "target": "service_agent", "label": "מגדיר" } },
        { "data": { "source": "docker_compose", "target": "service_mcp_gateway", "label": "מגדיר" } },
        { "data": { "source": "service_agent", "target": "service_frontend", "label": "תלוי ב-" } },

        // Services to Dockerfiles
        { "data": { "source": "service_frontend", "target": "dockerfile_frontend", "label": "נבנה מ-" } },
        { "data": { "source": "service_agent", "target": "dockerfile_agent", "label": "נבנה מ-" } },
        { "data": { "source": "service_mcp_gateway", "target": "dockerfile_mcp", "label": "נבנה מ-" } },

        // Dockerfiles to Base Image
        { "data": { "source": "dockerfile_frontend", "target": "base_image_node20", "label": "מבוסס על" } },
        { "data": { "source": "dockerfile_agent", "target": "base_image_node20", "label": "מבוסס על" } },
        { "data": { "source": "dockerfile_mcp", "target": "base_image_node20", "label": "מבוסס על" } },
        
        // Package.json to Libraries
        { "data": { "source": "package_json", "target": "lib_next", "label": "תלות" } },
        { "data": { "source": "package_json", "target": "lib_react", "label": "תלות" } },
        { "data": { "source": "package_json", "target": "lib_playwright", "label": "תלות" } },
        { "data": { "source": "package_json", "target": "lib_socketio", "label": "תלות" } },

        // Code Dependencies
        { "data": { "source": "src_server", "target": "lib_next", "label": "משתמש ב-" } },
        { "data": { "source": "src_server", "target": "lib_socketio", "label": "משתמש ב-" } },
        { "data": { "source": "src_server", "target": "src_dashboard", "label": "מייבא את" } },
        { "data": { "source": "src_agent", "target": "lib_playwright", "label": "משתמש ב-" } },
        { "data": { "source": "src_agent", "target": "src_browser", "label": "מייבא את" } },
        { "data": { "source": "src_agent", "target": "src_gemini", "label": "מייבא את" } },
        { "data": { "source": "src_agent", "target": "src_config", "label": "מייבא את" } },
        { "data": { "source": "src_browser", "target": "lib_playwright", "label": "משתמש ב-" } },
        { "data": { "source": "src_browser", "target": "src_config", "label": "מייבא את" } },
        { "data": { "source": "src_gemini", "target": "src_config", "label": "מייבא את" } },
        
        // Frontend Dependencies
        { "data": { "source": "src_app_page", "target": "lib_react", "label": "משתמש ב-" } },
        { "data": { "source": "src_app_layout", "target": "lib_react", "label": "משתמש ב-" } },
        { "data": { "source": "src_app_layout", "target": "src_app_page", "label": "מרנדר את" } },
        { "data": { "source": "src_app_page", "target": "src_header_component", "label": "מייבא את" } },
        { "data": { "source": "service_frontend", "target": "src_server", "label": "מריץ" } },
        { "data": { "source": "service_agent", "target": "src_agent", "label": "מריץ" } }
      ]
    };

    document.addEventListener('DOMContentLoaded', function () {
      const cy = cytoscape({
        container: document.getElementById('cy'),
        elements: [ ...architectureData.nodes, ...architectureData.edges ],
        style: [
          {
            selector: 'node',
            style: {
              'background-color': '#6b7280',
              'label': 'data(label)',
              'width': 'label',
              'height': 'label',
              'padding': '12px',
              'shape': 'round-rectangle',
              'color': '#ffffff',
              'text-valign': 'center',
              'font-size': '11px',
              'text-wrap': 'wrap',
              'text-max-width': '100px',
              'border-width': '1px',
              'border-color': '#4b5563'
            }
          },
          {
            selector: 'edge',
            style: {
              'width': 1.5,
              'line-color': '#d1d5db',
              'target-arrow-color': '#d1d5db',
              'target-arrow-shape': 'triangle',
              'curve-style': 'bezier',
              'label': 'data(label)',
              'font-size': '9px',
              'color': '#4b5563',
              'text-rotation': 'autorotate'
            }
          },
          { selector: '[type="service"]', style: { 'background-color': '#3b82f6' } },
          { selector: '[type="config"]', style: { 'background-color': '#f97316' } },
          { selector: '[type="manifest"]', style: { 'background-color': '#f59e0b' } },
          { selector: '[type="dockerfile"]', style: { 'background-color': '#0ea5e9' } },
          { selector: '[type="base-image"]', style: { 'background-color': '#06b6d4', 'shape': 'octagon' } },
          { selector: '[type="component"]', style: { 'background-color': '#10b981' } },
          { selector: '[type="module"]', style: { 'background-color': '#8b5cf6' } },
          { selector: '[type="entrypoint"]', style: { 'background-color': '#ec4899', 'shape': 'diamond', 'border-width': '2px', 'border-color': '#db2777' } },
          { selector: '[type="library"]', style: { 'background-color': '#64748b', 'shape': 'ellipse' } }
        ],
        layout: {
          name: 'dagre',
          rankDir: 'TB',
          spacingFactor: 1.2,
          nodeSep: 60,
          rankSep: 80
        }
      });
    });
  </script>
</body>
</html>